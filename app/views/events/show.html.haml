= content_for :title, "#{@event.event_group.sw_name} @ #{@event.venue.sw_name}"

= render 'events/units/breadcrumbs', event: @event

.billboard<>
  %img{src: @event.event_group.sw_image_url}<>
  %div<>
    %h4= @event.event_group.sw_name
    .right
      %a{href: edit_event_url(@event)} edit
    %h6= @event.venue.sw_name + ', ' + @event.city.full_name
    %h5= @event.sw_date.strftime('%a, %-d %b %Y at %I:%M %P')
    %a{href: event_group_url(@event.event_group)}= @event.event_group.sw_name

%p.description<>= @event.description
    

.information<>
  %h3<>
    Buy tickets for
    = @event.event_group.sw_name
    %small
      %span= @event.sw_ticket_count
      ticket(s) avaiable
      
      
  #spinner<>
    %img{src: '/assets/spinner.gif'}
  .tickets
    %table#tickets{style: 'display: none'}<>
      %thead
        %tr
          %th Block
          %th Row
          %th Qty
          %th Price
          %th 
      %tbody#tickets-entries
  .seatmap<>
    %h4
      %a{href: venue_path(@event.venue)}= @event.venue.sw_name
    - if @event.layout.sw_seat_map_url
      %img{src: @event.layout.sw_seat_map_url}
    - else
      %p There are no seatmap avaiable!
  .map<>
    %h4
      %b Adress:
      = @event.venue.sw_address.values.join ', '
    - lng, lat = @event.location
    - options = {center: "#{lat},#{lng}", zoom: 13, size: '640x160', markers: "color:blue|#{lat},#{lng}", sensor: false}
    %img{src: "http://maps.googleapis.com/maps/api/staticmap?#{options.to_query}"}


:coffeescript
  $ ->
    getJSONP = (url) ->
      $.ajax
        dataType: "jsonp"
        url: url
        cache: true

    ticket_groups_url = "#{SeatWave.base_uri}event/#{@event.id}/ticketgroups?apikey=#{SeatWave.api_key}&pgnumber=1&siteid=#{SeatWave.site_id}&pgsize=1000&callback=?"
    
    getJSONP(ticket_groups_url).done (webResponse) ->
      $.each webResponse.TicketGroups, ->
        $("#tickets-entries").append $("<tr><td>" + @Block + "</td><td>" + @Row + "</td><td>" + @Qty + "</td><td>" + @Price + " " + @Currency + "</td><td><a class=\"button small expand round\" href=\"" + @SwURL + "\">Buy</a></td></tr>")
      $("#tickets").show() if webResponse.TicketGroups.length > 0
      $("#spinner").hide()
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      